---
title: "Regressão Linear Múltipla"
author: "Larysa Mendes, Vitória Maria, Welly Remígio" 
format: html
number-sections: true
toc: true
toc-depth: 3
lang: pt
date: today
editor: visual
---

```{r Setup}
#| echo: true

# Setup para o relatório Quarto

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

# Definindo o espelho do CRAN
options(repos = c(CRAN = "https://cloud.r-project.org/"))


```

# Introdução

Este relatório tem por objetivo ajustar um modelo de regressão linear múltiplo com o intuito de investigar a influência de determinadas características associadas a vendas de cadeirinhas de carro para crianças e diversos fatores que podem influenciar essas vendas.
dasdasd
Neste contexto a regressão será realizada sobre base de dados `Carseats`, que trata das vendas de cadeirinhas de carro para crianças (Child Car Seats) em diferentes locais. Essa base está na biblioteca ISLR (An Introduction to Statistical Learning with Applications in R) que é um pacote em R que acompanha o famoso livro "An Introduction to Statistical Learning" (ISLR). Ela contém vários conjuntos de dados usados para demonstrar técnicas de aprendizado estatístico e machine learning. Essa base de dados contém onze variáveis, sendo três destas quanlitativas, as demais são medidas quantitativas.

# Os dados 

É possível baixar os dados do livro [An Introduction to Statistical Learning with applications in R](https://www.statlearning.com/), mas o pacote `ISLR` pode ser baixado diretamente do *R*, para acessar a base de dados, `Carseats`.

```{r}
install.packages("ISLR", quiet=TRUE) #instalando pacote
library(ISLR) #chamando pacote

setwd("C:\\Users\\Notebook\\Documents\\Relatorio_Estatistica")
write.table(Carseats , file="nome_do_arquivo.csv", sep=";", dec=",") #criando arquivo .csv no local de 
#help("Carseats") #descrição das variáveis
#glimpse(Carseats)

```

Descrição da Base de Dados:
Número de observações: 400
Variável Resposta:
- `Sales`: Vendas de cadeirinhas de carro em diferentes locais. (Milhares de unidades)

  
Variáveis Explicativas:
- `CompPrice`: Preço da cadeirinha na loja concorrente. (em dólares).  
- `Income`: Renda média dos consumidores naquela região. (em milhares de dólares).  
- `Advertising`: Valor gasto em publicidade para aquela região (em milhares de dólares).  
- `Population`: População da região. (em milhares).  
- `Price`: Preço da cadeirinha de carro na loja.(em dólares).  
- `ShelveLoc`: Qualidade da localização da prateleira na loja. ("Good", "Medium", "Bad").  
- `Age`: Idade média da população na região. (em anos).  
- `Education`: Nível médio de educação da população na região.(em anos).  
- `Urban`: Um fator que indica se a região é urbana. ("Yes" ou "No").  
- `US`: Um fator que indica se a loja está nos EUA. ("Yes" ou "No").  



## Análise exploratória dos dados

```{r}
library(skimr)

dados <- Carseats

skim(dados)

```

### Comentários:
De acordo com a tabela é possível observar que não há ausência de dados.
# INCOMPLETO



### Análise de Correlação {#sec-GGally}
```{r}
install.packages("GGally", quite=TRUE)
library(GGally)# Pacote para função ggpairs
library(ggplot2)


### Multicolinearidade: r > 0.9 (ou 0.8)

#Gráfico com a variável qualitativa US

graf1 <- ggpairs(dados, 
                 columns = c("Sales", "CompPrice", "Income", "Advertising", "Population", "Price", "Age", "Education"), 
                 ggplot2::aes(colour=US), 
                 upper = list(continuous = wrap("cor", size = 3)), 
                 lower = list(continuous = "points")) +            
  theme_minimal() +                                              
  theme(axis.text = element_text(size = 8),                      
        legend.position = "bottom",                              
        strip.text = element_text(size = 10))    

graf1


#Gráfico com a variável qualitativa Urban

graf2 <- ggpairs(dados, 
                 columns = c("Sales", "CompPrice", "Income", "Advertising", "Population", "Price", "Age", "Education"), 
                 ggplot2::aes(colour=Urban), 
                 upper = list(continuous = wrap("cor", size = 3)), 
                 lower = list(continuous = "points")) +            
  theme_minimal() +                                              
  theme(axis.text = element_text(size = 8),                      
        legend.position = "bottom",                              
        strip.text = element_text(size = 10))    

graf2


#Gráfico com a variável qualitativa ShelveLoc

graf3 <- ggpairs(dados, 
                 columns = c("Sales", "CompPrice", "Income", "Advertising", "Population", "Price", "Age", "Education"), 
                 ggplot2::aes(colour=ShelveLoc), 
                 upper = list(continuous = wrap("cor", size = 3)), 
                 lower = list(continuous = "points")) +            
  theme_minimal() +                                              
  theme(axis.text = element_text(size = 8),                      
        legend.position = "bottom",                              
        strip.text = element_text(size = 10))    

graf3

# Salvando o gráfico em .jpeg
ggsave("Grafico_dispersao_carseats.jpeg")

```

#### Comentários

Com relação à análise de correlação é algo desejável observar altas correlações das variáveis independentes com relação à variável dependente que no presente caso é `Sales`.

Por outro lado, altas correlações entre as demais variáveis a serem utilizadas como variáveis independentes nos dá indícios de que haverá **problemas de multicolinearidade** ao ajustar o MRLM. **Como regra geral** isto ocorre quando há **correlações** $\geq 0.9$ ou $\geq 0.8$ **entre** as **variáveis preditoras**.

Dito isto, é possível observar que:

1)  A variável dependente `Sales`:

<!-- -->

i.  não apresenta correlação linear significante com a variável `CompPrice` (r= 0,064, p \> 0.10);

ii. apresenta correlação linear significante com a variável `Income` (r= 0.152, p \< 0.001);

iii. apresenta correlação linear significante com a variável `Advertising` (r= 0.270, p \< 0.001);

iv. não apresenta correlação linear significante com a variável `Population` (r= 0.050, p \> 0.10);

v. apresenta correlação linear significante com a variável `Price` (r= -0.445, p \< 0.001);

vi. apresenta correlação linear significante com a variável `Age` (r= -0.232, p \< 0.001);

vii. não apresenta correlação linear significante com a variável `Education` (r= -0.052,  p \> 0.10);

<!-- -->


Uma maneira de identificar a multicolinearidade é através do **Fator de Inflação da Variância (VIF)**.

O **VIF é calculado** para cada preditor fazendo uma regressão linear desse preditor em todos os outros preditores e, então, obtendo o $R^2$ dessa regressão. O VIF é apenas $1/(1-R^2)$.

**Como interpretar o VIF?**\

> Um **valor maior que 5** indica correlação **potencialmente grave** entre uma determinada variável preditora e outras variáveis preditoras no modelo. Nesse caso, as estimativas de coeficiente e os valores de p na saída da regressão provavelmente não são confiáveis.

> **VIF \> 10** indica **problema de multicolinearidade**.

\ 
Veja abaixo **como obter o vif** usando o *R*, desconsiderando as variáveis ShelveLoc, US e Urban.


```{r}


#modelo1 <- lm(Sales ~ . - ShelveLoc - US - Urban, data = dados)
modelo1 <- lm(Sales ~ CompPrice + Income + Advertising + Population + Price + ShelveLoc + Age + Education + Urban + US, data = dados)

library(car) 

vif(modelo1)
```
Como podemos ver, nenhuma das variáveis tem o VIF > 10, logo isso indica que não há um problema de multicolinearidade. 
\

# Modelo 1 (Com todas as variáveis)

```{r}
summary(modelo1)

```

Ao observar o primeiro modelo com o intuito de prever a variável `Sales`, tem-se que aproximadamente 87,34% (Multiple R-squared: 0,8734) da variação nas vendas é explicada pelas variáveis independentes, o que é um bom ajuste. Um valor de 86,98% (Adjusted R-squared: 0,8698) confirma que, mesmo ajustando para o número de variáveis no modelo, o ajuste ainda é forte. Isso é importante porque evita o viés de um R² inflado quando são adicionados mais preditores. 
O valor de F elevado e o p-valor muito baixo (< 2.2e-16) indicam que o modelo como um todo é estatisticamente significativo, ou seja, pelo menos uma das variáveis independentes está associada às vendas. 

O modelo de regressão parece fornecer uma boa explicação para as vendas com base nas variáveis incluídas, especialmente o preço (`Price`), o preço dos concorrentes (`CompPrice`), a renda (`Income`), a publicidade (`Advertising`) e a idade (`Age`). Contudo, `Population`, `Education`, `Urban` e `US` não mostraram-se significativas.
\


## Modelo sem `Population` (modelo2) {#sec-modelo2selecionado}

```{r}
modelo2 <- update(modelo1, ~ . - Population)

summary(modelo2)

```


> Observa-se que para este modelo ajustado ocorreu um aumento no valor da adequação de ajuste do modelo para 87,01% (Adjusted R-squared: 0.8701).
\


## Modelo sem `Education` (modelo3)

```{r}
modelo3 <- update(modelo1, ~ . - Education)

summary(modelo3)

```
> Observa-se que para este modelo ajustado o valor da adequação de ajuste do modelo continuou igual ao modelo 1 com 86,98% (Adjusted R-squared: 0.8698).



## Modelo sem `Urban` (modelo4)

```{r}
modelo4 <- update(modelo1, ~ . - Urban)

summary(modelo4)

```
> Observa-se que para este modelo ajustado o valor da adequação de ajuste do modelo continuou igual ao modelo 1 com 86,98% (Adjusted R-squared: 0.8698).


## Modelo sem `US` (modelo5)

```{r}
modelo5 <- update(modelo1, ~ . - US)

summary(modelo5)

```
> Observa-se que para este modelo ajustado o valor da adequação de ajuste do modelo diminuiu em comparação com o modelo 1, ficando com 86,97% (Adjusted R-squared: 0.8697).


## Modelo sem `Population`, `Education`, `Urban` e `US` (modelo6)

```{r}
modelo6 <- update(modelo1, ~ . -Population - Education - Urban - US)

summary(modelo6)

```
> Observa-se que para este modelo ajustado o valor da adequação de ajuste do modelo diminuiu em comparação com o modelo 1, ficando com 86,97% (Adjusted R-squared: 0.8697).

\


# Métodos de seleção de modelos




